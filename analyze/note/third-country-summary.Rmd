---
title: "Analysis of apparent third-country deportations"
author: "UWCHR"
date: "2025-07-02"
output:
    html_document:
        html_preview: true
        toc: true
        toc_depth: 3
        toc_float: true
        code_folding: hide
---

- Third country removals
	- of people arrested in SEA
	- of people detained at CSCNWWA
	- from SEA directly

```{r setup, message=FALSE, warning=FALSE, include=TRUE}

options(scipen = 1000000)

library(pacman)

p_load(here, tidyverse, zoo, lubridate, ggplot2, ggforce, plotly, gghighlight, viridis, readxl, ggVennDiagram)

```

```{r setup_arrests, message=FALSE, warning=FALSE, include=TRUE}

file <- "2025-ICLI-00019_2024-ICFO-39357_ERO_Admin_Arrests_LESA-STU_FINAL_unprotected.xlsx"

arrest_df<- read_excel(here('analyze', 'input', file), skip=5) %>% 
  janitor::clean_names()

arrest_df <- arrest_df %>% 
  mutate(apprehension_date = as.Date(apprehension_date)) |>
  # mutate(apprehension_method = fct(apprehension_method)) |>
  mutate(criminality = apprehension_criminality == "1 Convicted Criminal") |>
  mutate(n_dupe = row_number(), .by = c("apprehension_date", "apprehension_method", "apprehension_criminality", "unique_identifier")) |>
  filter(!is.na(unique_identifier))

arrest_ids <- unique(arrest_df$unique_identifier)

```

```{r setup_detention, message=FALSE, warning=FALSE, include=TRUE}

file <- "ice_detentions_nov23-jun25.csv.gz"

detention_df <- read_delim(here('analyze', 'input', file), delim='|') %>% 
  filter(!is.na(unique_identifier)) %>% 
  mutate(stay_book_in_date_time = ymd_hms(stay_book_in_date_time),
         book_in_date_time = ymd_hms(book_in_date_time),
         detention_book_out_date_time = ymd_hms(detention_book_out_date_time),
         stay_book_out_date_time = ymd_hms(stay_book_out_date_time),
         stay_book_out_date = ymd(stay_book_out_date),
         book_in_fy = substr(quarter(book_in_date_time, fiscal_start = 10, type = "year.quarter"), 1, 4),
         stay_book_in_fy = substr(quarter(stay_book_in_date_time, fiscal_start = 10, type = "year.quarter"), 1, 4))


detention_df <- detention_df %>% 
  group_by(unique_identifier) %>% 
  arrange(stay_book_in_date_time, book_in_date_time, unique_identifier) %>% 
  ungroup()

detention_ids <- unique(detention_df$unique_identifier)

```

```{r setup_removals, message=FALSE, warning=FALSE, include=TRUE}

file <- "2025-ICLI-00019_2024-ICFO-39357_ICE_Removals_LESA-STU_FINAL_2025only_unprotected.xlsx"

removals_df <- read_excel(here('analyze', 'input', file), skip=6) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(unique_identifier))

removal_ids <- unique(removals_df$unique_identifier)

```

# Arrests/removals

```{r national_arrests_removals}

dat1 <- arrest_df %>% 
  mutate(week = floor_date(apprehension_date, "week", week_start = "Monday")) %>% 
  count(week) %>% 
  mutate(type = "arrests")

dat2 <- removals_df %>% 
  mutate(week = floor_date(departed_date, "week", week_start = "Monday")) %>% 
  count(week) %>% 
  mutate(type = "removals")

dat <- rbind(dat1, dat2)

p1 <- dat %>% 
  filter(week > "2023-08-28",
         week < "2025-06-09") %>% 
  ggplot(aes(x=week, y=n, color=type)) +
  geom_line() +
  ylim(0, NA) +
  ylab("Total") +
  xlab("Date") +
  labs(title = "Nationwide total weekly ICE arrests and removals",
       caption = "Source: ICE data obtained by Deportation Data Project")

p1

```


# Third country deportations

All datasets include `citizenship_country` and `departure_country` fields which could indicate third-country deportations. Most comprehensive set of potential cases is drawn from combination of databases (here focusing on arrests, detentions, removals). Be alert for discrepancies between these datasets.

```{r third_country_deportations_ids}

removals_third_country_ids <- removals_df %>% 
  filter(departure_country != citizenship_country) %>% 
  dplyr::select(unique_identifier)

arrests_third_country_ids <- arrest_df %>% 
  filter(!is.na(departure_country)) %>% 
  filter(departure_country != citizenship_country) %>% 
  dplyr::select(unique_identifier)

detention_third_country_ids <- detention_df %>% 
  filter(!is.na(departure_country)) %>% 
  filter(departure_country != citizenship_country) %>% 
  dplyr::select(unique_identifier)

third_country_ids <- union(removals_third_country_ids, arrests_third_country_ids)

third_country_ids <- unlist(union(third_country_ids, detention_third_country_ids))

```

```{r pct_third_country_natl}

removals_df <- removals_df %>% 
  mutate(third_country_deport = citizenship_country != departure_country)

dat <- removals_df %>% 
  mutate(week = floor_date(departed_date, "week", week_start = "Monday")) %>% 
  count(week, third_country_deport) %>% 
  mutate(type = "national")

dat_wide <- dat %>% 
  pivot_wider(id_cols = c("week"), names_from = "third_country_deport", names_prefix = "third_country_", values_from = "n") %>% 
  group_by(week) %>% 
  mutate(pct_third_country = third_country_TRUE / sum(third_country_TRUE, third_country_FALSE),
         type = "removals dataset")

p1 <- dat_wide %>% 
  ggplot(aes(x = week, y = pct_third_country)) +
  geom_line() +
  scale_y_continuous(labels = scales::percent) +
  ylim(0, NA) +
  labs(title = "Third-country deportations as % of weekly total",
       subtitle = "Nationwide, since Jan. 2025",
       caption = "Source: ICE 'removals' dataset obtained by DDP")

p1

```

```{r pct_third_country_natl_via_arrests}

arrest_df <- arrest_df %>% 
  mutate(third_country_deport = citizenship_country != departure_country)

dat1 <- arrest_df %>% 
  filter(!is.na(departure_country),
    departed_date >= "2023-11-01") %>% 
  mutate(week = floor_date(departed_date, "week", week_start = "Monday")) %>% 
  count(week, third_country_deport) %>% 
  mutate(type = "arrests dataset")

dat1_wide <- dat1 %>% 
  pivot_wider(id_cols = c("week"), names_from = "third_country_deport", names_prefix = "third_country_", values_from = "n") %>% 
  group_by(week) %>% 
  mutate(pct_third_country = third_country_TRUE / sum(third_country_TRUE, third_country_FALSE),
         type = "national_via_arrests")

p1 <- dat1_wide %>% 
  ggplot(aes(x = week, y = pct_third_country)) +
  geom_line() +
  scale_y_continuous(labels = scales::percent) +
  ylim(0, NA) +
  labs(title = "Third-country deportations as % of weekly total",
       subtitle = "Nationwide, since Nov. 2023",
       caption = "Source: ICE 'arrests' dataset obtained by DDP")

p1

```

```{r compare}

compare_dat <- rbind(dat_wide, dat1_wide)

p1 <- compare_dat %>% 
  ggplot(aes(x = week, y = pct_third_country, color = type)) +
  geom_line() +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Third-country deportations as % of weekly total",
       subtitle = "Comparison of records drawn from arrests versus removals datasets")

p1

```

```{r pct_third_country_docket_aor}

dat <- removals_df %>% 
  mutate(week = floor_date(departed_date, "week", week_start = "Monday"),
         docket_aor = str_replace(docket_aor, " Area of Responsibility", "")) %>% 
  count(week, third_country_deport, docket_aor) %>% 
  mutate(type = "national")

dat_wide <- dat %>% 
  pivot_wider(id_cols = c("week", "docket_aor"), names_from = "third_country_deport", names_prefix = "third_country_", values_from = "n") %>% 
  group_by(week, docket_aor) %>% 
  mutate(pct_third_country = third_country_TRUE / sum(third_country_TRUE, third_country_FALSE))

p1 <- dat_wide %>% 
  ggplot(aes(x = week, y = pct_third_country)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Third-country deportations as % of weekly total",
       subtitle = "per removal docket AOR, since Jan. 2025") +
  facet_wrap(~docket_aor)

p1

```

```{r pct_third_country_apprehension_aor}

dat <- arrest_df %>% 
  filter(departed_date >= "2025-01-01") %>% 
  mutate(week = floor_date(departed_date, "week", week_start = "Monday"),
         apprehension_aor = str_replace(apprehension_aor, " Area of Responsibility", "")) %>% 
  count(week, third_country_deport, apprehension_aor) %>% 
  mutate(type = "national")

dat_wide <- dat %>% 
  pivot_wider(id_cols = c("week", "apprehension_aor"), names_from = "third_country_deport", names_prefix = "third_country_", values_from = "n") %>% 
  group_by(week, apprehension_aor) %>% 
  mutate(pct_third_country = third_country_TRUE / sum(third_country_TRUE, third_country_FALSE))

p1 <- dat_wide %>% 
  ggplot(aes(x = week, y = pct_third_country)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Third-country deportations as % of weekly total",
       subtitle = "per apprehension AOR, since Jan. 2025") +
  facet_wrap(~apprehension_aor)

p1

```

```{r citizenship_departure_country}

tab1 <- removals_df %>% 
  filter(third_country_deport == TRUE) %>% 
  count(citizenship_country, departure_country) %>% 
  arrange(desc(n))

p1 <- tab1 %>% 
  mutate(name = paste(citizenship_country, departure_country, sep = "-"),
         name = fct_reorder(name, desc(n))) %>% 
  head(10) %>% 
  ggplot(aes(y = name, x = n)) +
  geom_col() +
  labs(title = "Top 10 citizenship-departure country pairs")

p1

tab1.1 <- removals_df %>% 
  filter(third_country_deport == TRUE) %>% 
  count(citizenship_country) %>% 
  mutate(citizenship_country = fct_reorder(citizenship_country, desc(n))) %>% 
  arrange(desc(n))

p1.1 <- tab1.1 %>% 
  head(10) %>% 
  ggplot(aes(y = citizenship_country, x = n)) +
  geom_col() +
  labs(title = "Top 10 third-country removals by citizenship")

p1.1  

tab1.2 <- removals_df %>% 
  filter(third_country_deport == TRUE) %>% 
  count(departure_country) %>% 
  mutate(departure_country = fct_reorder(departure_country, desc(n))) %>% 
  arrange(desc(n))

p1.2 <- tab1.2 %>% 
  head(10) %>% 
  ggplot(aes(y = departure_country, x = n)) +
  geom_col() +
  labs(title = "Top 10 third-country removals by departure country")

p1.2 

```

